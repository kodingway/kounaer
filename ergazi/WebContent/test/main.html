<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>OpenLayers MyMap Layer Example</title>
<link rel="stylesheet" href="../openlayers-2.12/theme/default/style.css"
	type="text/css">
<link rel="stylesheet"
	href="../openlayers-2.12/theme/default/google.css" type="text/css">
<link rel="stylesheet" href="../openlayers-2.12/examples/style.css"
	type="text/css">
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.3"></script>
<script language="javascript"
	src="http://api.amap.com/webapi/init?v=1.1"></script>
<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
<script src="../openlayers-2.12/lib/OpenLayers.js"></script>
<script src="../openlayers-2.12/lib/deprecated.js"></script>
<script language="javascript" src=http://api.51ditu.com/js/maps.js></script>
<script>
	var map;
	function init() {
		OpenLayers.ProxyHost = "/cgi/proxy.cgi?url=";
		map = new OpenLayers.Map('map');
		map.addControl(new OpenLayers.Control.LayerSwitcher());

		var hmap = new OpenLayers.Layer.Baidu("百度混合图", {
			type : "BMAP_HYBRID_MAP"
		});

		var bmap = new OpenLayers.Layer.Baidu("百度街道图", {
			type : "BMAP_NORMAL_MAP"
		});

		var amap = new OpenLayers.Layer.Amap("高德街道图", {});

		var gmap = new OpenLayers.Layer.Google("谷歌街道图", {
			numZoomLevels : 20
		});

		var lmap = new OpenLayers.Layer.Ditu51("灵图街道图", {});

		var smap = new OpenLayers.Layer.Soso("腾讯街道图", {});

		var somap = new OpenLayers.Layer.SosoSate("腾讯卫星图", {});

		var mmap = new OpenLayers.Layer.Mapabc("高德企业版", {});

		var china_popplaces = new OpenLayers.Layer.WMS("全国地区分布",
				"http://192.168.4.200:8080/geoserver/postgis/wms", {
					LAYERS : 'postgis:prc_popplaces',
					STYLES : '',
					format : "image/jpeg",
					tiled : true,
					transparent : true
				}, {
					buffer : 0,
					displayOutsideMaxExtent : true,
					isBaseLayer : false,
					visibility : false,
					yx : {
						'EPSG:4326' : true
					}
				});
		map.addLayers([ smap, somap, amap, gmap, lmap, mmap, china_popplaces ]);

		map.setCenter(new OpenLayers.LonLat(116.31444444444445,
				39.96055555555556).transform(new OpenLayers.Projection(
				"EPSG:4326"), map.getProjectionObject()), 10);

		getMarker = function(lng, lat, name, open) {
			var marker = new OpenLayers.Marker(new OpenLayers.LonLat(lng, lat)
					.transform(new OpenLayers.Projection("EPSG:4326"), map
							.getProjectionObject()))
			marker.events.remove("mousedown");
			popupClass = OpenLayers.Popup.FramedCloud;
			popupContentHTML = name;
			feature = new OpenLayers.Feature(markers, marker.lonlat);
			feature.closeBox = true;
			feature.popupClass = popupClass;
			feature.data.popupContentHTML = popupContentHTML;
			feature.data.autoSize = true;
			var popup = feature.createPopup(feature.closeBox);
			map.addPopup(popup);
			if (!open) {
				popup.hide();
			}
			var markerClick = function(evt) {
				popup.toggle();
				OpenLayers.Event.stop(evt);
			};
			marker.events.register("mousedown", feature, markerClick);
			return marker;
		};

		var markers = new OpenLayers.Layer.Markers("我的自定义点");
		markers.addMarker(getMarker(104.06342451, 30.59527611, "李许言", false));
		markers.addMarker(getMarker(120.142448, 30.171483, "曹志富", false));
		markers.addMarker(getMarker(111.66266741, 40.81721844, "冯晓婷", false));
		markers.addMarker(getMarker(106.70633, 26.57816, "张新改", false));
		markers.addMarker(getMarker(117.21252947123342, 39.10680336710836,
				"姜桥", false));
		markers.addMarker(getMarker(102.71484342, 25.04603794, "李青", false));
		markers.addMarker(getMarker(116.9888888888889, 36.66305555555556, "李森",
				false));
		markers.addMarker(getMarker(116.31444444444445, 39.96055555555556,
				"胡文华", false));
		map.addLayer(markers);

		map.events
				.register(
						'click',
						map,
						function(e) {
							document.getElementById('shortdesc').innerHTML = "Loading... please wait...";
							var params = {
								REQUEST : "GetFeatureInfo",
								EXCEPTIONS : "application/vnd.ogc.se_xml",
								BBOX : map.getExtent().toBBOX(),
								SERVICE : "WMS",
								INFO_FORMAT : 'text/html',
								QUERY_LAYERS : map.layers[6].params.LAYERS,
								FEATURE_COUNT : 50,
								Layers : 'postgis:prc_popplaces',
								WIDTH : map.size.w,
								HEIGHT : map.size.h,
								format : "image/png",
								styles : map.layers[6].params.STYLES,
								srs : map.layers[6].params.SRS
							};
							if (map.layers[6].params.VERSION == "1.3.0") {
								params.version = "1.3.0";
								params.j = e.xy.x;
								params.i = e.xy.y;
							} else {
								params.version = "1.1.1";
								params.x = Math.floor(e.xy.x);
								params.y = Math.floor(e.xy.y);
							}

							if (map.layers[6].params.CQL_FILTER != null) {
								params.cql_filter = map.layers[6].params.CQL_FILTER;
							}
							if (map.layers[6].params.FILTER != null) {
								params.filter = map.layers[6].params.FILTER;
							}
							if (map.layers[6].params.FEATUREID) {
								params.featureid = map.layers[6].params.FEATUREID;
							}
							OpenLayers.loadURL("http://192.168.4.200:8080/geoserver/postgis/wms",params,this,setHTML,setHTML);
							OpenLayers.Event.stop(e);
						});
	}
	setHTML = function(response) {
		document.getElementById('shortdesc').innerHTML = "Demonstrate use the Mapabc/Amap/Google/Ditu51/Soso Maps API.";
		document.getElementById('result').innerHTML = response.responseText;
	};
</script>
</head>
<body onload="init()">
	<h1 id="title">地图2.0版综合测试</h1>
	<div id="tags">Baidu, api key, apikey, light</div>
	<p id="shortdesc">Demonstrate use the
		Mapabc/Amap/Google/Ditu51/Soso Maps API.</p>
	<div id="map" class="smallmap"></div>
	<div id="result" class="smallmap"></div>
</body>
</html>
